import{_ as $,D as P,g as B,a as i,c as n,b as t,d as r,w as S,n as m,t as c,f as v,i as f,e as y,m as K,v as O,u as M,j as p,r as R,p as U,T as G,q as w,o as V,s as W,F as k,h as C,W as q,G as N,k as F,x as j}from"./index-uCgvljN_.js";import{L as x}from"./localeText-Bx9UFssG.js";import{_ as z}from"./protocolBadge-C2R7ON7V.js";import{C as J}from"./storageMount.vue_vue_type_style_index_0_scoped_5d74c517_lang-Bc24giwJ.js";const D={name:"configurationCard",components:{ProtocolBadge:z,LocaleText:x},props:{c:{Name:String,Status:Boolean,PublicKey:String,PrivateKey:String},delay:String,display:String},data(){return{configurationToggling:!1}},setup(){return{dashboardConfigurationStore:P()}},methods:{toggle(){this.configurationToggling=!0,B("/api/toggleWireguardConfiguration/",{configurationName:this.c.Name},e=>{e.status?this.dashboardConfigurationStore.newMessage("Server",`${this.c.Name} ${e.data?"is on":"is off"}`):this.dashboardConfigurationStore.newMessage("Server",e.message,"danger"),this.c.Status=e.data,this.configurationToggling=!1})}}},T=()=>{M(e=>({d75b06ae:e.delay}))},I=D.setup;D.setup=I?(e,s)=>(T(),I(e,s)):T;const E={class:"card conf_card rounded-3 shadow text-decoration-none"},H={class:"mb-0"},Y={class:"card-title mb-0 d-flex align-items-center gap-2"},A={class:"card-footer d-flex gap-2 flex-column"},Q={class:"row"},X={class:"d-flex gap-2 align-items-center"},Z={class:"text-muted"},tt={class:"mb-0 d-block d-lg-inline-block"},et={style:{"line-break":"anywhere"}},st={class:"form-check form-switch ms-auto"},ot=["for"],it={key:4,class:"spinner-border spinner-border-sm ms-2","aria-hidden":"true"},at=["disabled","id"];function nt(e,s,o,_,a,g){const d=p("ProtocolBadge"),u=p("RouterLink"),l=p("LocaleText");return i(),n("div",{class:m(["col-12",{"col-lg-6 col-xl-4":this.display==="Grid"}])},[t("div",E,[r(u,{to:"/configuration/"+o.c.Name+"/peers",class:"card-body d-flex align-items-center gap-3 flex-wrap text-decoration-none"},{default:S(()=>[t("h6",H,[t("span",{class:m(["dot",{active:o.c.Status}])},null,2)]),t("h6",Y,[t("samp",null,c(o.c.Name),1),t("small",null,[r(d,{protocol:o.c.Protocol,mini:!0},null,8,["protocol"])])]),s[2]||(s[2]=t("h6",{class:"mb-0 ms-auto"},[t("i",{class:"bi bi-chevron-right"})],-1))]),_:1},8,["to"]),t("div",A,[t("div",Q,[t("small",{class:m(["col-6",{"col-md-3":this.display==="List"}])},[s[3]||(s[3]=t("i",{class:"bi bi-arrow-down-up me-2"},null,-1)),v(c(o.c.DataUsage.Total>0?o.c.DataUsage.Total.toFixed(4):0)+" GB ",1)],2),t("small",{class:m(["text-primary-emphasis col-6",{"col-md-3":this.display==="List"}])},[s[4]||(s[4]=t("i",{class:"bi bi-arrow-down me-2"},null,-1)),v(c(o.c.DataUsage.Receive>0?o.c.DataUsage.Receive.toFixed(4):0)+" GB ",1)],2),t("small",{class:m(["text-success-emphasis col-6",{"col-md-3":this.display==="List"}])},[s[5]||(s[5]=t("i",{class:"bi bi-arrow-up me-2"},null,-1)),v(c(o.c.DataUsage.Sent>0?o.c.DataUsage.Sent.toFixed(4):0)+" GB ",1)],2),t("small",{class:m(["col-6",{"col-md-3 text-md-end ":this.display==="List"}])},[t("span",{class:m(["dot me-2",{active:o.c.ConnectedPeers>0}])},null,2),v(" "+c(o.c.ConnectedPeers)+" / "+c(o.c.TotalPeers)+" ",1),r(l,{t:"Peers"})],2)]),t("div",{class:m(["d-flex gap-2",[this.display==="Grid"?"flex-column":"gap-lg-3 flex-column flex-lg-row"]])},[t("div",X,[t("small",Z,[t("strong",null,[r(l,{t:"Public Key"})])]),t("small",tt,[t("samp",et,c(o.c.PublicKey),1)])]),t("div",st,[t("label",{class:"form-check-label",style:{cursor:"pointer"},for:"switch"+o.c.PrivateKey},[!o.c.Status&&this.configurationToggling?(i(),f(l,{key:0,t:"Turning Off..."})):o.c.Status&&this.configurationToggling?(i(),f(l,{key:1,t:"Turning On..."})):o.c.Status&&!this.configurationToggling?(i(),f(l,{key:2,t:"On"})):!o.c.Status&&!this.configurationToggling?(i(),f(l,{key:3,t:"Off"})):y("",!0),this.configurationToggling?(i(),n("span",it)):y("",!0)],8,ot),K(t("input",{class:"form-check-input",style:{cursor:"pointer"},disabled:this.configurationToggling,type:"checkbox",role:"switch",id:"switch"+o.c.PrivateKey,onChange:s[0]||(s[0]=L=>this.toggle()),"onUpdate:modelValue":s[1]||(s[1]=L=>o.c.Status=L)},null,40,at),[[O,o.c.Status]])])],2)])])],2)}const rt=$(D,[["render",nt],["__scopeId","data-v-6451623a"]]),lt={class:"text-muted me-2"},ct={class:"fw-bold"},dt={__name:"storageMount",props:{mount:String,percentage:Number,align:Boolean,square:Boolean},setup(e){M(a=>({"703ec95e":_.value}));const s=e,o=R(!1),_=U(()=>s.square?"40px":"25px");return(a,g)=>(i(),n("div",{class:"flex-grow-1 square rounded-3 border position-relative",onMouseenter:g[0]||(g[0]=d=>o.value=!0),onMouseleave:g[1]||(g[1]=d=>o.value=!1),style:w({"background-color":`rgb(25 135 84 / ${e.percentage}%)`})},[r(G,{name:"zoomReversed"},{default:S(()=>[o.value?(i(),n("div",{key:0,style:{"white-space":"nowrap"},class:m(["floatingLabel z-3 border position-absolute d-block p-1 px-2 bg-body text-body rounded-3 border shadow d-flex",[e.align?"end-0":"start-0"]])},[t("small",lt,[t("samp",null,c(e.mount),1)]),t("small",ct,c(e.percentage)+"% ",1)],2)):y("",!0)]),_:1})],36))}},ut=$(dt,[["__scopeId","data-v-5d74c517"]]),mt={class:"row text-body g-3 mb-5"},gt={class:"col-md-6 col-sm-12 col-xl-3"},ht={class:"d-flex align-items-center"},_t={class:"text-muted"},ft={class:"ms-auto"},pt={key:0},yt={key:1,class:"spinner-border spinner-border-sm"},bt={class:"progress",role:"progressbar",style:{height:"6px"}},St={class:"d-flex mt-2 gap-1"},vt={class:"col-md-6 col-sm-12 col-xl-3"},xt={class:"d-flex align-items-center"},wt={class:"text-muted"},kt={class:"ms-auto"},Ct={key:0},Lt={key:1,class:"spinner-border spinner-border-sm"},$t={class:"progress",role:"progressbar",style:{height:"6px"}},Nt={class:"d-flex mt-2 gap-1"},Dt={class:"col-md-6 col-sm-12 col-xl-3"},Tt={class:"d-flex align-items-center"},It={class:"text-muted"},Pt={class:"ms-auto"},Bt={key:0},Kt={key:1,class:"spinner-border spinner-border-sm"},Mt={class:"progress",role:"progressbar",style:{height:"6px"}},Ut={class:"col-md-6 col-sm-12 col-xl-3"},Gt={class:"d-flex align-items-center"},Ot={class:"text-muted"},Rt={class:"ms-auto"},Vt={key:0},Wt={key:1,class:"spinner-border spinner-border-sm"},qt={class:"progress",role:"progressbar",style:{height:"6px"}},Ft={__name:"systemStatusWidget",setup(e){const s=P();let o=null;V(()=>{_(),o=setInterval(()=>{_()},5e3)}),W(()=>{clearInterval(o)});const _=()=>{B("/api/systemStatus",{},g=>{s.SystemStatus=g.data})},a=U(()=>s.SystemStatus);return(g,d)=>(i(),n("div",mt,[t("div",gt,[t("div",ht,[t("h6",_t,[d[0]||(d[0]=t("i",{class:"bi bi-cpu-fill me-2"},null,-1)),r(x,{t:"CPU"})]),t("h6",ft,[a.value?(i(),n("span",pt,c(a.value.cpu.cpu_percent)+"% ",1)):(i(),n("span",yt))])]),t("div",bt,[t("div",{class:"progress-bar",style:w({width:`${a.value?.cpu.cpu_percent}%`})},null,4)]),t("div",St,[(i(!0),n(k,null,C(a.value?.cpu.cpu_percent_per_cpu,(u,l)=>(i(),f(J,{key:l,align:l+1>Math.round(a.value?.cpu.cpu_percent_per_cpu.length/2),core_number:l,percentage:u},null,8,["align","core_number","percentage"]))),128))])]),t("div",vt,[t("div",xt,[t("h6",wt,[d[1]||(d[1]=t("i",{class:"bi bi-device-ssd-fill me-2"},null,-1)),r(x,{t:"Storage"})]),t("h6",kt,[a.value?(i(),n("span",Ct,c(a.value?.disk["/"].percent)+"% ",1)):(i(),n("span",Lt))])]),t("div",$t,[t("div",{class:"progress-bar bg-success",style:w({width:`${a.value?.disk["/"].percent}%`})},null,4)]),t("div",Nt,[a.value?(i(!0),n(k,{key:0},C(Object.keys(a.value?.disk),(u,l)=>(i(),f(ut,{key:l,align:l+1>Math.round(Object.keys(a.value?.disk).length/2),mount:u,percentage:a.value?.disk[u].percent},null,8,["align","mount","percentage"]))),128)):y("",!0)])]),t("div",Dt,[t("div",Tt,[t("h6",It,[d[2]||(d[2]=t("i",{class:"bi bi-memory me-2"},null,-1)),r(x,{t:"Memory"})]),t("h6",Pt,[a.value?(i(),n("span",Bt,c(a.value?.memory.virtual_memory.percent)+"% ",1)):(i(),n("span",Kt))])]),t("div",Mt,[t("div",{class:"progress-bar bg-info",style:w({width:`${a.value?.memory.virtual_memory.percent}%`})},null,4)])]),t("div",Ut,[t("div",Gt,[t("h6",Ot,[d[3]||(d[3]=t("i",{class:"bi bi-memory me-2"},null,-1)),r(x,{t:"Swap Memory"})]),t("h6",Rt,[a.value?(i(),n("span",Vt,c(a.value?.memory.swap_memory.percent)+"% ",1)):(i(),n("span",Wt))])]),t("div",qt,[t("div",{class:"progress-bar bg-warning",style:w({width:`${a.value?.memory.swap_memory.percent}%`})},null,4)])])]))}},jt=$(Ft,[["__scopeId","data-v-435b92ba"]]),zt={name:"configurationList",components:{SystemStatus:jt,LocaleText:x,ConfigurationCard:rt},async setup(){return{wireguardConfigurationsStore:q()}},data(){return{configurationLoaded:!1,sort:{Name:N("Name"),Status:N("Status"),"DataUsage.Total":N("Total Usage")},currentSort:{key:"Name",order:"asc"},currentDisplay:"List",searchKey:""}},async mounted(){window.localStorage.getItem("ConfigurationListSort")?this.currentSort=JSON.parse(window.localStorage.getItem("ConfigurationListSort")):window.localStorage.setItem("ConfigurationListSort",JSON.stringify(this.currentSort)),window.localStorage.getItem("ConfigurationListDisplay")?this.currentDisplay=window.localStorage.getItem("ConfigurationListDisplay"):window.localStorage.setItem("ConfigurationListDisplay",this.currentDisplay),await this.wireguardConfigurationsStore.getConfigurations(),this.configurationLoaded=!0,this.wireguardConfigurationsStore.ConfigurationListInterval=setInterval(()=>{this.wireguardConfigurationsStore.getConfigurations()},1e4)},beforeUnmount(){clearInterval(this.wireguardConfigurationsStore.ConfigurationListInterval)},computed:{configurations(){return[...this.wireguardConfigurationsStore.Configurations].filter(e=>e.Name.toLowerCase().includes(this.searchKey)||e.PublicKey.includes(this.searchKey)||!this.searchKey).sort((e,s)=>this.currentSort.order==="desc"?this.dotNotation(e,this.currentSort.key)<this.dotNotation(s,this.currentSort.key)?1:this.dotNotation(e,this.currentSort.key)>this.dotNotation(s,this.currentSort.key)?-1:0:this.dotNotation(e,this.currentSort.key)>this.dotNotation(s,this.currentSort.key)?1:this.dotNotation(e,this.currentSort.key)<this.dotNotation(s,this.currentSort.key)?-1:0)}},methods:{dotNotation(e,s){let o=s.split(".").reduce((_,a)=>_&&_[a],e);return typeof o=="string"?o.toLowerCase():o},updateSort(e){this.currentSort.key===e?this.currentSort.order==="asc"?this.currentSort.order="desc":this.currentSort.order="asc":this.currentSort.key=e,window.localStorage.setItem("ConfigurationListSort",JSON.stringify(this.currentSort))},updateDisplay(e){this.currentDisplay!==e&&(this.currentDisplay=e,window.localStorage.setItem("ConfigurationListDisplay",this.currentDisplay))}}},Jt={class:"mt-md-5 mt-3"},Et={class:"container-fluid"},Ht={class:"d-flex mb-4 configurationListTitle align-items-md-center gap-2 flex-column flex-md-row"},Yt={class:"text-body d-flex mb-0"},At={key:0,class:"text-body filter mb-3 d-flex gap-2 flex-column flex-md-row"},Qt={class:"d-flex align-items-center gap-3 align-items-center mb-3 mb-md-0"},Xt={class:"text-muted"},Zt={class:"d-flex ms-auto ms-lg-0"},te=["onClick"],ee={class:"align-items-center gap-3 align-items-center mb-3 mb-md-0 d-none d-lg-flex"},se={class:"text-muted"},oe={class:"d-flex ms-auto ms-lg-0"},ie=["onClick"],ae={class:"d-flex align-items-center ms-md-auto"},ne={class:"row g-3 mb-2"},re={class:"text-muted col-12",key:"noConfiguration"};function le(e,s,o,_,a,g){const d=p("SystemStatus"),u=p("LocaleText"),l=p("RouterLink"),L=p("ConfigurationCard");return i(),n("div",Jt,[t("div",Et,[r(d),t("div",Ht,[t("h2",Yt,[r(u,{t:"WireGuard Configurations"})]),r(l,{to:"/new_configuration",class:"ms-md-auto py-2 text-decoration-none btn text-primary-emphasis bg-primary-subtle rounded-3 border-1 border-primary-subtle"},{default:S(()=>[s[1]||(s[1]=t("i",{class:"bi bi-plus-circle me-2"},null,-1)),r(u,{t:"Configuration"})]),_:1}),r(l,{to:"/restore_configuration",class:"py-2 text-decoration-none btn text-primary-emphasis bg-primary-subtle rounded-3 border-1 border-primary-subtle"},{default:S(()=>[s[2]||(s[2]=t("i",{class:"bi bi-clock-history me-2"},null,-1)),r(u,{t:"Restore"})]),_:1})]),r(G,{name:"fade"},{default:S(()=>[this.configurationLoaded?(i(),n("div",At,[t("div",Qt,[t("small",Xt,[r(u,{t:"Sort By"})]),t("div",Zt,[(i(!0),n(k,null,C(this.sort,(h,b)=>(i(),n("a",{role:"button",onClick:ce=>g.updateSort(b),class:m([{"bg-primary-subtle text-primary-emphasis":this.currentSort.key===b},"px-2 py-1 rounded-3"])},[t("small",null,[this.currentSort.key===b?(i(),n("i",{key:0,class:m(["bi me-2",[this.currentSort.order==="asc"?"bi-sort-up":"bi-sort-down"]])},null,2)):y("",!0),v(c(h),1)])],10,te))),256))])]),t("div",ee,[t("small",se,[r(u,{t:"Display as"})]),t("div",oe,[(i(),n(k,null,C([{name:"List",key:"list"},{name:"Grid",key:"grid"}],h=>t("a",{role:"button",onClick:b=>g.updateDisplay(h.name),class:m([{"bg-primary-subtle text-primary-emphasis":this.currentDisplay===h.name},"px-2 py-1 rounded-3"])},[t("small",null,[t("i",{class:m(["bi me-2","bi-"+h.key])},null,2),v(" "+c(h.name),1)])],10,ie)),64))])]),t("div",ae,[s[3]||(s[3]=t("label",{for:"configurationSearch",class:"text-muted"},[t("i",{class:"bi bi-search me-2"})],-1)),K(t("input",{class:"form-control form-control-sm rounded-3","onUpdate:modelValue":s[0]||(s[0]=h=>this.searchKey=h),id:"configurationSearch"},null,512),[[j,this.searchKey]])])])):y("",!0)]),_:1}),t("div",ne,[r(F,{name:"fade"},{default:S(()=>[this.configurationLoaded&&this.wireguardConfigurationsStore.Configurations.length===0?(i(),n("p",re,[r(u,{t:"You don't have any WireGuard configurations yet. Please check the configuration folder or change it in Settings. By default the folder is /etc/wireguard."})])):this.configurationLoaded?(i(!0),n(k,{key:1},C(g.configurations,(h,b)=>(i(),f(L,{display:this.currentDisplay,delay:b*.03+"s",key:h.Name,c:h},null,8,["display","delay","c"]))),128)):y("",!0)]),_:1})])])])}const he=$(zt,[["render",le],["__scopeId","data-v-0ac2bdcc"]]);export{he as default};
