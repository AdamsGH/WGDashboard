import{p as C}from"./index-L60y6kc9.js";import{_ as P,W as x,r as L,g as K,y as k,c as a,b as e,d as o,w as S,n as m,m as l,z as c,t as u,f as b,F as p,h as v,e as A,j as _,a as r}from"./index-CRrH8rsP.js";import{L as N}from"./localeText-BwuzYH16.js";const q={name:"newConfiguration",components:{LocaleText:N},async setup(){const s=x(),t=L([]);return await K("/api/protocolsEnabled",{},d=>{t.value=d.data}),{store:s,protocols:t}},data(){return{newConfiguration:{ConfigurationName:"",Address:"",ListenPort:"",PrivateKey:"",PublicKey:"",PresharedKey:"",PreUp:"",PreDown:"",PostUp:"",PostDown:"",Protocol:"wg",Jc:5,Jmin:49,Jmax:998,S1:17,S2:110,H1:0,H2:0,H3:0,H4:0},numberOfAvailableIPs:"0",error:!1,errorMessage:"",success:!1,loading:!1}},created(){this.wireguardGenerateKeypair();let s=[];for(;[...new Set(s)].length!==4;)s=[this.rand(1,2**31-1),this.rand(1,2**31-1),this.rand(1,2**31-1),this.rand(1,2**31-1)];this.newConfiguration.H1=s[0],this.newConfiguration.H2=s[1],this.newConfiguration.H3=s[2],this.newConfiguration.H4=s[3]},methods:{rand(s,t){return Math.floor(Math.random()*(t-s)+s)},wireguardGenerateKeypair(){const s=window.wireguard.generateKeypair();this.newConfiguration.PrivateKey=s.privateKey,this.newConfiguration.PublicKey=s.publicKey,this.newConfiguration.PresharedKey=s.presharedKey},async saveNewConfiguration(){this.goodToSubmit&&(this.loading=!0,await k("/api/addWireguardConfiguration",this.newConfiguration,async s=>{s.status?(this.success=!0,await this.store.getConfigurations(),this.$router.push(`/configuration/${this.newConfiguration.ConfigurationName}/peers`)):(this.error=!0,this.errorMessage=s.message,document.querySelector(`#${s.data}`).classList.remove("is-valid"),document.querySelector(`#${s.data}`).classList.add("is-invalid"),this.loading=!1)}))}},computed:{goodToSubmit(){let s=["ConfigurationName","Address","ListenPort","PrivateKey"],t=[...document.querySelectorAll("input[required]")];return s.find(d=>this.newConfiguration[d].length===0)===void 0&&t.find(d=>d.classList.contains("is-invalid"))===void 0}},watch:{"newConfiguration.Address"(s){let t=document.querySelector("#Address");t.classList.remove("is-invalid","is-valid");try{if(s.trim().split("/").filter(h=>h.length>0).length!==2)throw Error();let d=C(s),f=d.end-d.start;this.numberOfAvailableIPs=f.toLocaleString(),t.classList.add("is-valid")}catch{this.numberOfAvailableIPs="0",t.classList.add("is-invalid")}},"newConfiguration.ListenPort"(s){let t=document.querySelector("#ListenPort");t.classList.remove("is-invalid","is-valid"),s<0||s>65353||!Number.isInteger(s)?t.classList.add("is-invalid"):t.classList.add("is-valid")},"newConfiguration.ConfigurationName"(s){let t=document.querySelector("#ConfigurationName");t.classList.remove("is-invalid","is-valid"),!/^[a-zA-Z0-9_=+.-]{1,15}$/.test(s)||s.length===0||this.store.Configurations.find(d=>d.Name===s)?t.classList.add("is-invalid"):t.classList.add("is-valid")},"newConfiguration.PrivateKey"(s){let t=document.querySelector("#PrivateKey");t.classList.remove("is-invalid","is-valid");try{wireguard.generatePublicKey(s),t.classList.add("is-valid")}catch{t.classList.add("is-invalid")}}}},U={class:"mt-md-5 mt-3 text-body"},H={class:"container mb-4"},I={class:"mb-4 d-flex align-items-center gap-4"},$={class:"mb-0"},D={class:"card rounded-3 shadow"},O={class:"card-header"},V={class:"card-body d-flex gap-2 protocolBtnGroup"},M={key:0,class:"bi bi-check-circle-fill me-2"},T={key:1,class:"bi bi-circle me-2"},G={key:0,class:"bi bi-check-circle-fill me-2"},B={key:1,class:"bi bi-circle me-2"},J={class:"card rounded-3 shadow"},z={class:"card-header"},R={class:"card-body"},W=["disabled"],E={class:"invalid-feedback"},F={key:0},j={key:1},Z={class:"mb-0"},Q={class:"card rounded-3 shadow"},X={class:"card-header"},Y={class:"card-body",style:{"font-family":"var(--bs-font-monospace)"}},ee={class:"mb-2"},te={class:"text-muted fw-bold mb-1"},se={class:"input-group"},ie=["disabled"],oe={class:"text-muted fw-bold mb-1"},ne={class:"card rounded-3 shadow"},ae={class:"card-header"},re={class:"card-body"},de=["disabled"],le={class:"invalid-feedback"},ce={key:0},ue={key:1},he={class:"card rounded-3 shadow"},ge={class:"card-header d-flex align-items-center"},fe={class:"badge rounded-pill text-bg-success ms-auto"},me={class:"card-body"},be=["disabled"],pe={class:"invalid-feedback"},ve={key:0},_e={key:1},we={class:"accordion",id:"newConfigurationOptionalAccordion"},ye={class:"accordion-item"},Ce={class:"accordion-header"},Pe={class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#newConfigurationOptionalAccordionCollapse"},xe={id:"newConfigurationOptionalAccordionCollapse",class:"accordion-collapse collapse","data-bs-parent":"#newConfigurationOptionalAccordion"},Le={class:"accordion-body d-flex flex-column gap-3"},Ke={class:"card rounded-3"},ke={class:"card-header"},Se={class:"card-body"},Ae=["id","onUpdate:modelValue"],Ne={class:"card rounded-3"},qe={class:"card-header"},Ue={class:"card-body"},He=["id","onUpdate:modelValue"],Ie=["disabled"],$e={key:0,class:"d-flex w-100"},De={key:1,class:"d-flex w-100"},Oe={key:2,class:"d-flex w-100 align-items-center"};function Ve(s,t,d,f,h,w){const y=_("RouterLink"),n=_("LocaleText");return r(),a("div",U,[e("div",H,[e("div",I,[o(y,{to:"/",class:"btn btn-dark btn-brand p-2 shadow",style:{"border-radius":"100%"}},{default:S(()=>t[9]||(t[9]=[e("h2",{class:"mb-0",style:{"line-height":"0"}},[e("i",{class:"bi bi-arrow-left-circle"})],-1)])),_:1}),e("h2",$,[o(n,{t:"New Configuration"})])]),e("form",{class:"text-body d-flex flex-column gap-3",onSubmit:t[8]||(t[8]=i=>{i.preventDefault(),this.saveNewConfiguration()})},[e("div",D,[e("div",O,[o(n,{t:"Protocol"})]),e("div",V,[e("a",{onClick:t[0]||(t[0]=i=>this.newConfiguration.Protocol="wg"),class:m([{"opacity-50":this.newConfiguration.Protocol!=="wg"},"btn btn-primary wireguardBg border-0"]),style:{"flex-basis":"100%"}},[this.newConfiguration.Protocol==="wg"?(r(),a("i",M)):(r(),a("i",T)),t[10]||(t[10]=e("strong",null," WireGuard ",-1))],2),e("a",{onClick:t[1]||(t[1]=i=>this.newConfiguration.Protocol="awg"),class:m([{"opacity-50":this.newConfiguration.Protocol!=="awg"},"btn btn-primary amneziawgBg border-0"]),style:{"flex-basis":"100%"}},[this.newConfiguration.Protocol==="awg"?(r(),a("i",G)):(r(),a("i",B)),t[11]||(t[11]=e("strong",null," AmneziaWG ",-1))],2)])]),e("div",J,[e("div",z,[o(n,{t:"Configuration Name"})]),e("div",R,[l(e("input",{type:"text",class:"form-control",placeholder:"ex. wg1",id:"ConfigurationName","onUpdate:modelValue":t[2]||(t[2]=i=>this.newConfiguration.ConfigurationName=i),disabled:this.loading,required:""},null,8,W),[[c,this.newConfiguration.ConfigurationName]]),e("div",E,[this.error?(r(),a("div",F,u(this.errorMessage),1)):(r(),a("div",j,[o(n,{t:"Configuration name is invalid. Possible reasons:"}),e("ul",Z,[e("li",null,[o(n,{t:"Configuration name already exist."})]),e("li",null,[o(n,{t:"Configuration name can only contain 15 lower/uppercase alphabet, numbers, underscore, equal sign, plus sign, period and hyphen."})])])]))])])]),e("div",Q,[e("div",X,[o(n,{t:"Private Key"}),t[12]||(t[12]=b(" & ")),o(n,{t:"Public Key"})]),e("div",Y,[e("div",ee,[e("label",te,[e("small",null,[o(n,{t:"Private Key"})])]),e("div",se,[l(e("input",{type:"text",class:"form-control",id:"PrivateKey",required:"",disabled:this.loading,"onUpdate:modelValue":t[3]||(t[3]=i=>this.newConfiguration.PrivateKey=i)},null,8,ie),[[c,this.newConfiguration.PrivateKey]]),e("button",{class:"btn btn-outline-primary",type:"button",title:"Regenerate Private Key",onClick:t[4]||(t[4]=i=>w.wireguardGenerateKeypair())},t[13]||(t[13]=[e("i",{class:"bi bi-arrow-repeat"},null,-1)]))])]),e("div",null,[e("label",oe,[e("small",null,[o(n,{t:"Public Key"})])]),l(e("input",{type:"text",class:"form-control",id:"PublicKey","onUpdate:modelValue":t[5]||(t[5]=i=>this.newConfiguration.PublicKey=i),disabled:""},null,512),[[c,this.newConfiguration.PublicKey]])])])]),e("div",ne,[e("div",ae,[o(n,{t:"Listen Port"})]),e("div",re,[l(e("input",{type:"number",class:"form-control",placeholder:"0-65353",id:"ListenPort",min:"1",max:"65353","onUpdate:modelValue":t[6]||(t[6]=i=>this.newConfiguration.ListenPort=i),disabled:this.loading,required:""},null,8,de),[[c,this.newConfiguration.ListenPort]]),e("div",le,[this.error?(r(),a("div",ce,u(this.errorMessage),1)):(r(),a("div",ue,[o(n,{t:"Invalid port"})]))])])]),e("div",he,[e("div",ge,[o(n,{t:"IP Address/CIDR"}),e("span",fe,u(h.numberOfAvailableIPs)+" Available IPs",1)]),e("div",me,[l(e("input",{type:"text",class:"form-control",placeholder:"Ex: 10.0.0.1/24",id:"Address","onUpdate:modelValue":t[7]||(t[7]=i=>this.newConfiguration.Address=i),disabled:this.loading,required:""},null,8,be),[[c,this.newConfiguration.Address]]),e("div",pe,[this.error?(r(),a("div",ve,u(this.errorMessage),1)):(r(),a("div",_e," IP Address/CIDR is invalid "))])])]),t[18]||(t[18]=e("hr",null,null,-1)),e("div",we,[e("div",ye,[e("h2",Ce,[e("button",Pe,[o(n,{t:"Optional Settings"})])]),e("div",xe,[e("div",Le,[(r(),a(p,null,v(["PreUp","PreDown","PostUp","PostDown"],i=>e("div",Ke,[e("div",ke,u(i),1),e("div",Se,[l(e("input",{type:"text",class:"form-control font-monospace",id:i,"onUpdate:modelValue":g=>this.newConfiguration[i]=g},null,8,Ae),[[c,this.newConfiguration[i]]])])])),64)),this.newConfiguration.Protocol==="awg"?(r(),a(p,{key:0},v(["Jc","Jmin","Jmax","S1","S2","H1","H2","H3","H4"],i=>e("div",Ne,[e("div",qe,u(i),1),e("div",Ue,[l(e("input",{type:"text",class:"form-control font-monospace",id:i,"onUpdate:modelValue":g=>this.newConfiguration[i]=g},null,8,He),[[c,this.newConfiguration[i]]])])])),64)):A("",!0)])])])]),e("button",{class:"btn btn-dark btn-brand rounded-3 px-3 py-2 shadow ms-auto",disabled:!this.goodToSubmit||this.loading||this.success},[this.success?(r(),a("span",$e,[o(n,{t:"Success"}),t[14]||(t[14]=b("! ")),t[15]||(t[15]=e("i",{class:"bi bi-check-circle-fill ms-2"},null,-1))])):this.loading?(r(),a("span",Oe,[o(n,{t:"Saving..."}),t[17]||(t[17]=e("span",{class:"ms-2 spinner-border spinner-border-sm",role:"status"},null,-1))])):(r(),a("span",De,[t[16]||(t[16]=e("i",{class:"bi bi-save-fill me-2"},null,-1)),o(n,{t:"Save"})]))],8,Ie)],32)])])}const Be=P(q,[["render",Ve],["__scopeId","data-v-d074fb65"]]);export{Be as default};
